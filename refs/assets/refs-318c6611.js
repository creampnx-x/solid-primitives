import{h as X,c as M,a as m,d as G,o as K,j as Y,i as O,f as A,S as L,k as Z,F as ee,g as te,t as w,b as ne}from"./index-c2844c8a.js";var P=(e,t)=>e instanceof t||e&&e.constructor===t,W=e=>typeof e=="function"&&!e.length?e():e,H=e=>Array.isArray(e)?e:[e],se=()=>{let e=[];const t=()=>e=[];return{push:(...n)=>e.push(...n),execute(n,s,r,l){e.forEach(i=>i(n,s,r,l)),t()},clear:t}},re=e=>e.slice(),le=(e,t)=>{const n=re(e);return t(n),n},oe=(e,t,n=0,...s)=>le(e,r=>r.splice(t,n,...s)),ce=(e,t,...n)=>{const s=e.indexOf(t);return oe(e,s,1,...n)},ue=(e,...t)=>{const n=[];for(let s=0;s<e.length;s++){const r=e[s],l=t.indexOf(r);l!==-1?t.splice(l,1):n.push(r)}return n},ie=(e,...t)=>t.length===1?e.filter(n=>P(n,t[0])):e.filter(n=>n&&t.some(s=>P(n,s)));let ae=z;const D=1,R=2,fe={owned:null,cleanups:null,context:null,owner:null};var h=null;let N=null,g=null,d=null,S=null,V=0;function pe(e,t){const n=g,s=h,r=e.length===0,l=r?fe:{owned:null,cleanups:null,context:null,owner:t===void 0?s:t},i=r?e:()=>e(()=>Q(()=>T(l)));h=l,g=null;try{return I(i,!0)}finally{g=n,h=s}}function Q(e){if(g===null)return e();const t=g;g=null;try{return e()}finally{g=t}}function he(e){return h===null||(h.cleanups===null?h.cleanups=[e]:h.cleanups.push(e)),e}function ge(){return h}function de(e,t){const n=h,s=g;h=e,g=null;try{return I(t,!0)}catch(r){j(r)}finally{h=n,g=s}}function ve(e,t,n){let s=e.value;return(!e.comparator||!e.comparator(s,t))&&(e.value=t,e.observers&&e.observers.length&&I(()=>{for(let r=0;r<e.observers.length;r+=1){const l=e.observers[r],i=N&&N.running;i&&N.disposed.has(l),(i&&!l.tState||!i&&!l.state)&&(l.pure?d.push(l):S.push(l),l.observers&&B(l)),i||(l.state=D)}if(d.length>1e6)throw d=[],new Error},!1)),t}function be(e){if(!e.fn)return;T(e);const t=h,n=g,s=V;g=h=e,me(e,e.value,s),g=n,h=t}function me(e,t,n){let s;try{s=e.fn(t)}catch(r){e.pure&&(e.state=D,e.owned&&e.owned.forEach(T),e.owned=null),j(r)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?ve(e,s):e.value=s,e.updatedAt=n)}function q(e){const t=N;if(e.state===0||t)return;if(e.state===R||t)return F(e);if(e.suspense&&Q(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<V);)(e.state||t)&&n.push(e);for(let s=n.length-1;s>=0;s--)if(e=n[s],e.state===D||t)be(e);else if(e.state===R||t){const r=d;d=null,I(()=>F(e,n[0]),!1),d=r}}function I(e,t){if(d)return e();let n=!1;t||(d=[]),S?n=!0:S=[],V++;try{const s=e();return we(n),s}catch(s){n||(S=null),d=null,j(s)}}function we(e){if(d&&(z(d),d=null),e)return;const t=S;S=null,t.length&&I(()=>ae(t),!1)}function z(e){for(let t=0;t<e.length;t++)q(e[t])}function F(e,t){const n=N;e.state=0;for(let s=0;s<e.sources.length;s+=1){const r=e.sources[s];r.sources&&(r.state===D||n?r!==t&&q(r):(r.state===R||n)&&F(r,t))}}function B(e){const t=N;for(let n=0;n<e.observers.length;n+=1){const s=e.observers[n];(!s.state||t)&&(s.state=R,s.pure?d.push(s):S.push(s),s.observers&&B(s))}}function T(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),s=e.sourceSlots.pop(),r=n.observers;if(r&&r.length){const l=r.pop(),i=n.observerSlots.pop();s<r.length&&(l.sourceSlots[i]=s,r[s]=l,n.observerSlots[s]=i)}}if(e.owned){for(t=0;t<e.owned.length;t++)T(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function $e(e){return e instanceof Error||typeof e=="string"?e:new Error("Unknown error")}function j(e){throw e=$e(e),e}function xe(e,...t){return t.length===0&&(t=[ge()]),pe(n=>(H(W(t)).forEach(s=>s&&de(s,he.bind(void 0,n))),e(n)),t[0])}const _e=(e,t)=>{const n=e.indexOf(t);e.splice(n,1)};function ye(e,...t){return M(()=>ie(H(e()),...t.length?t:[Element]))}const Ee=(e,t)=>{X(()=>t()(e))};function Se(e,t){let n=[];const s=new Set,r=t.length>1?new Map:void 0,l=Y(),[i,_]=m([]);G(K(e,k=>{const{length:C}=n,f=H(k).slice();if(!C)return _(n=f);for(let p=0,u=0;p<C;){const o=n[p];if(f.includes(o))p++,u++;else if(s.has(o)){const c=n.indexOf(f[u]);c!==-1&&c<=p?u++:(f.splice(u,0,o),r?.get(o)?.(u),p++)}else U(f,o,p),p++}_(n=f)}));let $=[];const E=()=>{$.length&&(_(k=>ue(k,...$)),$=[])};function U(k,C,f){xe(p=>{let u,o;if(r){const[a,v]=m(f),x=t(C,a),y=W(x);if(!y)return p();r.set(y,v),u=x,o=y}else{const a=t(C),v=W(a);if(!v)return p();u=a,o=v}s.add(o),k.splice(f,0,o);let c=o;G(K(u,a=>{if(s.delete(c),r){const v=r.get(c);if(r.delete(c),a)v&&r.set(a,v);else{const x=i();for(f=x.indexOf(c);f<x.length;f++)r.get(x[f])?.(y=>--y)}}if(!a)return _e(n,c),$.push(c),queueMicrotask(E),p();s.add(a),_(v=>ce(v,c,a)),c=a},{defer:!0}))},l)}return i}const ke=w('<div class="absolute bg-black"></div>'),Ce=w("<p>Elements count: </p>"),Ne=w('<div class="wrapper-h flex-wrap"><button class="btn">+ 1</button><button class="btn">- 1</button><button class="btn">toggle 0</button><button class="btn">toggle 1</button><button class="btn">toggle 2 & 3</button><button class="btn">toggle wrapper</button><button class="btn">clear</button></div>'),Ae=w("<p>Hello</p>"),Ie=w('<div class="node">ID 1</div>'),Oe=w('<div class="node">ID 2</div>'),Re=w('<div class="node">ID 3</div>'),De=w('<div class="wrapper-h flex-wrap"></div>'),Te=w('<div class="node">ID 0</div>'),Ue=w('<div class="node bg-yellow-600">.</div>'),Le=e=>{const t=ne(()=>e.children),n=ye(t,HTMLElement),s=se();return e.getClear?.(s.execute),Se(n,(l,i)=>{const[_,$]=m(l);return console.log("REMOVED",i()),s.push(()=>$(void 0)),l.style.filter="grayscale(100%)",l.style.position="relative",l.appendChild((()=>{const E=ke.cloneNode(!0);return O(E,i),E})()),l.addEventListener("click",()=>$(void 0)),_})},We=()=>{const[e,t]=m(!1),[n,s]=m(!1),[r,l]=m(!0),[i,_]=m(!0),[$,E]=m(5),[U,k]=m([]),[C,f]=m(0);setInterval(()=>f(u=>++u),1e3);let p;return[(()=>{const u=Ce.cloneNode(!0);return u.firstChild,O(u,()=>U().length,null),u})(),(()=>{const u=Ne.cloneNode(!0),o=u.firstChild,c=o.nextSibling,a=c.nextSibling,v=a.nextSibling,x=v.nextSibling,y=x.nextSibling,J=y.nextSibling;return o.$$click=()=>E(b=>++b),c.$$click=()=>E(b=>--b),a.$$click=()=>t(b=>!b),v.$$click=()=>s(b=>!b),x.$$click=()=>l(b=>!b),y.$$click=()=>_(b=>!b),J.$$click=()=>p(),u})(),(()=>{const u=De.cloneNode(!0);return O(u,A(Le,{getClear:o=>p=o,get children(){return A(L,{get when(){return i()},get children(){return[Ae.cloneNode(!0),"World",M(()=>M(()=>!!e())()&&Te.cloneNode(!0)),A(L,{get when(){return n()},get children(){return Ie.cloneNode(!0)}}),A(L,{get when(){return r()},get children(){return[(()=>{const o=Oe.cloneNode(!0);return Z(Ee,o,()=>c=>console.log("Unmounted",c)),o})(),Re.cloneNode(!0)]}}),A(ee,{get each(){return Array.from({length:$()},(o,c)=>c)},children:o=>(()=>{const c=Ue.cloneNode(!0),a=c.firstChild;return O(c,o+1,a),c})()})]}})}})),u})()]};te(["click"]);export{We as default};
